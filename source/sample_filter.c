/*
 * sample_filter.c
 *
 *  Created on: Nov 5, 2023
 *      Author: x2800m
 *
 */

#include "sample_filter.h"

static float filter_taps[SAMPLEFILTER_TAP_NUM] = {
  -0.006137841665540124,
  -0.0038852131794668756,
  -0.004877231003028763,
  -0.00583112813097586,
  -0.006671294318649045,
  -0.0073140011237796294,
  -0.007664471315344607,
  -0.0076296161710661435,
  -0.0071214508241243864,
  -0.0060555452164959825,
  -0.004370329200650407,
  -0.0020172485999727695,
  0.0010227749285396871,
  0.004743386570585335,
  0.009111336603020189,
  0.014060154578794096,
  0.01949612722794929,
  0.02529372275515974,
  0.031303279083777544,
  0.03735952346389453,
  0.043283798470128775,
  0.04889318306345676,
  0.054010620646239904,
  0.05845347254871293,
  0.06208837746205099,
  0.06477391199717239,
  0.06642708298895882,
  0.06698757871376272,
  0.06642708298895882,
  0.06477391199717239,
  0.06208837746205099,
  0.05845347254871293,
  0.054010620646239904,
  0.04889318306345676,
  0.043283798470128775,
  0.03735952346389453,
  0.031303279083777544,
  0.02529372275515974,
  0.01949612722794929,
  0.014060154578794096,
  0.009111336603020189,
  0.004743386570585335,
  0.0010227749285396871,
  -0.0020172485999727695,
  -0.004370329200650407,
  -0.0060555452164959825,
  -0.0071214508241243864,
  -0.0076296161710661435,
  -0.007664471315344607,
  -0.0073140011237796294,
  -0.006671294318649045,
  -0.00583112813097586,
  -0.004877231003028763,
  -0.0038852131794668756,
  -0.006137841665540124
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

float SampleFilter_get(SampleFilter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}

